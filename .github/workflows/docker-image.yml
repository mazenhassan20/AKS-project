name: Build and Push to ACR

on:
  push:
    branches: [ "main" ] # Ø£Ùˆ master Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ø§Ù†Ø´ Ø¹Ù†Ø¯Ùƒ
    paths:
      - 'backend/**'    # ÙŠØ´ØªØºÙ„ Ø¨Ø³ Ù„Ùˆ Ø¹Ø¯Ù„Øª ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯
      - 'frontend/**'   # ÙŠØ´ØªØºÙ„ Ø¨Ø³ Ù„Ùˆ Ø¹Ø¯Ù„Øª ÙÙŠ Ø§Ù„ÙØ±ÙˆÙ†Øª Ø¥Ù†Ø¯
      - '.github/workflows/**'

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
    - name: Check out the repo
      uses: actions/checkout@v3

    - name: Log in to Azure Container Registry
      uses: docker/login-action@v2
      with:
        registry: ${{ secrets.ACR_SERVER }}
        username: ${{ secrets.ACR_USERNAME }}
        password: ${{ secrets.ACR_PASSWORD }}

    # --- Backend Build & Push ---
    - name: Build and Push Backend
      uses: docker/build-push-action@v4
      with:
        context: ./backend             # ğŸ‘ˆ Ø¯Ù‡ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ù‡Ù…: Ø§Ù„Ø³ÙŠØ§Ù‚ Ù‡Ùˆ ÙÙˆÙ„Ø¯Ø± Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯
        file: ./backend/Dockerfile     # Ù…ÙƒØ§Ù† Ø§Ù„Ø¯ÙˆÙƒØ± ÙØ§ÙŠÙ„
        push: true
        tags: ${{ secrets.ACR_SERVER }}/backend:latest

    # --- Frontend Build & Push ---
    - name: Build and Push Frontend
      uses: docker/build-push-action@v4
      with:
        context: ./frontend            # ğŸ‘ˆ Ø§Ù„Ø³ÙŠØ§Ù‚ Ù‡Ùˆ ÙÙˆÙ„Ø¯Ø± Ø§Ù„ÙØ±ÙˆÙ†Øª Ø¥Ù†Ø¯
        file: ./frontend/Dockerfile
        push: true
        tags: ${{ secrets.ACR_SERVER }}/frontend:latest
