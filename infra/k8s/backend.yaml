apiVersion: v1
kind: Service
metadata:
apiVersion: v1
kind: Service
metadata:
  name: backend
spec:
  selector:
    app: backend
  ports:
    - protocol: TCP
      port: 80
      targetPort: 3000
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      initContainers:
      - name: init-db
        image: mazenelsayad1234.azurecr.io/backend:v1
        command: ['sh', '-c', 'npx prisma db push']
        env:
        - name: DATABASE_URL
          # ÙˆØ­Ø¯ØªÙ„Ùƒ Ø§Ù„ÙŠÙˆØ²Ø± ÙˆØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙŠØ¨Ù‚ÙˆØ§ Ø²ÙŠ Ø§Ù„Ù„ÙŠ ØªØ­Øª (myuser)
          value: "postgresql://myuser:mypassword@postgres:5432/mydb?schema=public"

      # ğŸ‘‡ Ù‡Ù†Ø§ Ø§Ù„ÙƒÙˆÙ†ØªÙŠÙ†Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨ØªØ§Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
      containers:
      - name: backend
        # âš ï¸ Ø§Ø³ØªØ¨Ø¯Ù„ PUT_YOUR_ACR_NAME_HERE Ø¨Ø§Ø³Ù… Ø§Ù„Ù€ ACR Ø¨ØªØ§Ø¹Ùƒ
        image: mazenelsayad1234.azurecr.io/backend:v1
        ports:
        - containerPort: 3000
        env:
        - name: DATABASE_URL
          value: "postgresql://myuser:mypassword@postgres:5432/mydb?schema=public"
        - name: NODE_ENV
          value: "production"
